version: '2'
services:
  front:
    build: front
    command: nodemon server.js
    volumes:
      - ./front:/app
    ports:
      - "5001:80"
      - "5858:5858"
    networks:
      - front-tier
      - back-tier
    links:
      - listener
  listener:
    build: listener
    command: nodemon server.js
    volumes:
      - ./listener:/app
    networks:
      - back-tier
  github:
    build: github
    command: nodemon server.js
    volumes:
      - ./github:/app
    networks:
      - back-tier
  logparser:
    build: logparser
    command: nodemon server.js
    volumes:
      - ./logparser:/app
    networks:
      - back-tier
  buildsaver:
    build: plugins/buildsaver
    command: nodemon server.js
    volumes:
      - ./plugins/buildsaver:/app
    networks:
      - back-tier
    links:
      - mongo
      - listener
  restartedbuilds:
    build: plugins/restartedbuilds
    command: nodemon server.js
    volumes:
      - ./plugins/restartedbuilds:/app
    networks:
      - back-tier
    links:
      - mongo
    cpuset: "0"
  mongo:
    image: mongo:latest
    ports:
      - "27017:27017"
    volumes:
      - db-data:/data/db
    networks:
      - back-tier
    healthcheck:
      test: echo 'db.runCommand("ping").ok' | mongo mongo:27017/test --quiet 1
      interval: 10s
      timeout: 10s
      retries: 5
      start_period: 40s
    cpuset: "0"
volumes:
  db-data:

networks:
  front-tier:
  back-tier: